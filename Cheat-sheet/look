#!/bin/bash

# look - Mostrar secciones de cheat-sheet con buscador por palabra clave

# Load environment variables
if [ -f "$HOME/bin/.env" ]; then 
    set -a
    source "$HOME/bin/.env"
    set +a
fi

CHEAT_DIR="${CHEAT_SHEETS_DIR:-$HOME/cheat-sheet}"
FILE="$CHEAT_DIR/$1.md"
SEARCH=$2

if [[ ! -f "$FILE" ]]; then
  echo -e "${RED}No se ha podido encontrar el archivo: $FILE${NC}"
  exit 1
fi

if [[ -z "$SEARCH" ]]; then
  # Si no se pasa búsqueda, mostrar índice
  grep "^## " "$FILE"
else
  # Si el segundo argumento es un número, mostrar sección exacta
  if [[ "$SEARCH" =~ ^[0-9]+$ ]]; then
    awk -v n="$SEARCH" '/^## / {sec=$2} sec==n {print}' "$FILE"
  else
    # Buscar por palabra clave dentro de todo el archivo
    echo -e "${BLUE}Buscando '$SEARCH' en $FILE...${NC}\n"
    grep --color=always -i -n "$SEARCH" "$FILE"
  fi
fi